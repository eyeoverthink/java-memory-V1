/* ═══════════════════════════════════════════════════════════ */
/* FRAY-VGA GRAPHICS DRIVER (Mode 13h)                         */
/* Direct Hardware Port Manipulation                           */
/* Generated by Fraymus Agent Brain v3.0                       */
/* φ^75 Validation Seal: 4721424167835376.00                  */
/* ═══════════════════════════════════════════════════════════ */

/* ═══════════════════════════════════════════════════════════ */
/* VGA HARDWARE PORTS                                           */
/* ═══════════════════════════════════════════════════════════ */

unsigned short VGA_AC_INDEX   = 0x3C0;  /* Attribute Controller */
unsigned short VGA_AC_WRITE   = 0x3C0;
unsigned short VGA_AC_READ    = 0x3C1;
unsigned short VGA_MISC_WRITE = 0x3C2;  /* Miscellaneous Output */
unsigned short VGA_SEQ_INDEX  = 0x3C4;  /* Sequencer */
unsigned short VGA_SEQ_DATA   = 0x3C5;
unsigned short VGA_GC_INDEX   = 0x3CE;  /* Graphics Controller */
unsigned short VGA_GC_DATA    = 0x3CF;
unsigned short VGA_CRTC_INDEX = 0x3D4;  /* CRT Controller */
unsigned short VGA_CRTC_DATA  = 0x3D5;
unsigned short VGA_INSTAT_READ = 0x3DA; /* Input Status */

/* ═══════════════════════════════════════════════════════════ */
/* HARDWARE I/O (Inline Assembly)                              */
/* ═══════════════════════════════════════════════════════════ */

/* Write byte to hardware port */
void outb(unsigned short port, unsigned char value) {
    __asm__("outb %1, %0" : : "dN"(port), "a"(value));
}

/* Read byte from hardware port */
unsigned char inb(unsigned short port) {
    unsigned char result;
    __asm__("inb %1, %0" : "=a"(result) : "Nd"(port));
    return result;
}

/* ═══════════════════════════════════════════════════════════ */
/* VGA MODE 13h INITIALIZATION                                  */
/* Resolution: 320x200, Colors: 256                             */
/* ═══════════════════════════════════════════════════════════ */

void init_vga() {
    /* Mode 13h is typically set by BIOS interrupt 0x10, AH=0x00, AL=0x13 */
    /* In protected mode without BIOS, we would manually program all VGA registers */
    /* For this demonstration, we assume bootloader or BIOS set Mode 13h */
    
    /* If implementing from scratch, would need to: */
    /* 1. Write to Miscellaneous Output Register */
    /* 2. Program Sequencer registers (5 registers) */
    /* 3. Program CRT Controller registers (25 registers) */
    /* 4. Program Graphics Controller registers (9 registers) */
    /* 5. Program Attribute Controller registers (21 registers) */
    
    /* Simplified init - clear screen */
    for(int i = 0; i < 320 * 200; i++) {
        vga_mem[i] = 0;  /* Black */
    }
}

/* ═══════════════════════════════════════════════════════════ */
/* VIDEO MEMORY ACCESS                                          */
/* ═══════════════════════════════════════════════════════════ */

/* VGA Memory Address (Mode 13h) */
unsigned char* vga_mem = (unsigned char*)0xA0000;

/* ═══════════════════════════════════════════════════════════ */
/* DRAWING PRIMITIVES                                           */
/* ═══════════════════════════════════════════════════════════ */

/* Draw single pixel */
void put_pixel(int x, int y, unsigned char color) {
    if(x >= 0 && x < 320 && y >= 0 && y < 200) {
        vga_mem[y * 320 + x] = color;
    }
}

/* Draw filled rectangle */
void draw_rect(int x, int y, int w, int h, unsigned char color) {
    for(int i = 0; i < w; i++) {
        for(int j = 0; j < h; j++) {
            put_pixel(x + i, y + j, color);
        }
    }
}

/* Draw horizontal line */
void draw_hline(int x1, int x2, int y, unsigned char color) {
    if(x1 > x2) { int t = x1; x1 = x2; x2 = t; }
    for(int x = x1; x <= x2; x++) {
        put_pixel(x, y, color);
    }
}

/* Draw vertical line */
void draw_vline(int x, int y1, int y2, unsigned char color) {
    if(y1 > y2) { int t = y1; y1 = y2; y2 = t; }
    for(int y = y1; y <= y2; y++) {
        put_pixel(x, y, color);
    }
}

/* Draw circle (Midpoint algorithm) */
void draw_circle(int cx, int cy, int radius, unsigned char color) {
    int x = radius;
    int y = 0;
    int err = 0;
    
    while(x >= y) {
        put_pixel(cx + x, cy + y, color);
        put_pixel(cx + y, cy + x, color);
        put_pixel(cx - y, cy + x, color);
        put_pixel(cx - x, cy + y, color);
        put_pixel(cx - x, cy - y, color);
        put_pixel(cx - y, cy - x, color);
        put_pixel(cx + y, cy - x, color);
        put_pixel(cx + x, cy - y, color);
        
        if(err <= 0) {
            y += 1;
            err += 2*y + 1;
        }
        if(err > 0) {
            x -= 1;
            err -= 2*x + 1;
        }
    }
}

/* ═══════════════════════════════════════════════════════════ */
/* FRAYMUS LOGO (Golden Ratio Visualization)                   */
/* ═══════════════════════════════════════════════════════════ */

void draw_fraymus_logo() {
    /* Clear screen to black */
    for(int i = 0; i < 320 * 200; i++) {
        vga_mem[i] = 0;
    }
    
    /* Golden Ratio φ = 1.618... */
    /* Draw Golden Rectangle composition */
    
    /* Main square (Red) */
    draw_rect(60, 50, 100, 100, 4);   /* Color 4 = Red */
    
    /* φ-scaled rectangle (Green) */
    /* Width = 100 / φ ≈ 62 */
    draw_rect(160, 50, 62, 100, 2);   /* Color 2 = Green */
    
    /* Smaller φ-scaled rectangle (Blue) */
    /* Height = 100 / φ ≈ 62, Width = 62 / φ ≈ 38 */
    draw_rect(160, 112, 62, 38, 1);   /* Color 1 = Blue */
    
    /* Even smaller rectangle (Yellow) */
    draw_rect(184, 112, 38, 24, 14);  /* Color 14 = Yellow */
    
    /* The Singularity - center point (White) */
    draw_circle(160, 100, 3, 15);     /* Color 15 = White */
    
    /* φ spiral approximation */
    /* Draw connecting arcs (simplified as lines) */
    draw_hline(60, 160, 50, 8);       /* Top line */
    draw_vline(160, 50, 150, 8);      /* Right line */
    draw_hline(60, 222, 150, 8);      /* Bottom line */
    draw_vline(60, 50, 150, 8);       /* Left line */
}

/* ═══════════════════════════════════════════════════════════ */
/* DEMO PATTERNS                                                */
/* ═══════════════════════════════════════════════════════════ */

void draw_test_pattern() {
    /* Rainbow gradient */
    for(int y = 0; y < 200; y++) {
        unsigned char color = (y * 256) / 200;
        draw_hline(0, 319, y, color);
    }
}

void draw_phi_spiral() {
    /* Fibonacci spiral approximation */
    int cx = 160, cy = 100;
    int radius = 5;
    
    for(int i = 0; i < 8; i++) {
        draw_circle(cx, cy, radius, 15 - i);
        radius = (radius * 16) / 10;  /* Approximate φ growth */
    }
}
