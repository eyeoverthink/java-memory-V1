<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>FRAYMUS TITAN // GEN 172 (BOOT)</title>
    <style>
        :root {
            --platinum: #E0E0E0;
            --obsidian: #050505;
            --amber: #FFB000;
            --cyan: #00F3FF;
            --glass: rgba(5, 5, 5, 0.9);
            --border: 1px solid rgba(255, 255, 255, 0.15);
        }

        body {
            margin: 0; overflow: hidden; background-color: #000;
            font-family: 'Courier New', monospace; color: var(--platinum);
            user-select: none;
        }

        /* --- BOOT LOADER (The New Layer) --- */
        #boot-screen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: #000;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        #boot-terminal {
            width: 500px;
            height: 300px;
            border: 1px solid #333;
            padding: 20px;
            background: rgba(10, 10, 10, 0.8);
            box-shadow: 0 0 50px rgba(0, 243, 255, 0.1);
            display: flex;
            flex-direction: column;
        }

        .boot-log {
            font-size: 12px; color: #888; margin-bottom: 5px;
            font-family: 'Courier New', monospace;
        }
        .boot-log.success { color: var(--cyan); }
        .boot-log.warn { color: var(--amber); }
        .boot-log.highlight { color: #FFF; font-weight: bold; }

        #progress-container {
            margin-top: auto;
            width: 100%;
            height: 4px;
            background: #222;
        }
        #progress-bar {
            width: 0%;
            height: 100%;
            background: var(--cyan);
            box-shadow: 0 0 10px var(--cyan);
            transition: width 0.1s;
        }

        /* --- MAIN UI (Hidden until boot complete) --- */
        #ui-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none;
            display: flex; flex-direction: column;
            opacity: 0; /* Hidden initially */
            transition: opacity 1s;
        }

        /* HEADER */
        #header {
            height: 40px; background: rgba(20, 20, 20, 0.9); border-bottom: 1px solid #333;
            display: flex; align-items: center; padding: 0 20px; justify-content: space-between;
            pointer-events: auto; backdrop-filter: blur(10px); z-index: 10;
        }
        .logo { font-weight: bold; letter-spacing: 2px; color: #FFF; text-shadow: 0 0 10px rgba(255,255,255,0.5); }
        .btn-group { display: flex; gap: 10px; }
        .sys-btn {
            background: transparent; color: #888; border: 1px solid #333; padding: 5px 20px;
            cursor: pointer; font-size: 11px; text-transform: uppercase; transition: 0.3s; letter-spacing: 1px;
        }
        .sys-btn:hover { border-color: var(--cyan); color: var(--cyan); box-shadow: 0 0 15px rgba(0, 243, 255, 0.2); }
        .sys-btn.active { background: rgba(0, 243, 255, 0.1); border-color: var(--cyan); color: var(--cyan); font-weight: bold; box-shadow: 0 0 20px rgba(0, 243, 255, 0.4); }

        /* SIDEBAR */
        #sidebar {
            position: absolute; top: 60px; left: 20px; width: 320px;
            background: var(--glass); border: var(--border); padding: 20px;
            pointer-events: auto; backdrop-filter: blur(10px);
            display: flex; flex-direction: column; gap: 15px;
            box-shadow: 0 0 30px rgba(0,0,0,0.5);
        }
        .panel-header {
            border-bottom: 1px solid #333; padding-bottom: 5px; color: var(--amber);
            font-size: 14px; letter-spacing: 2px; text-shadow: 0 0 5px rgba(255, 176, 0, 0.5);
        }
        .metric-row {
            display: flex; justify-content: space-between; font-size: 11px; margin-bottom: 6px;
            border-bottom: 1px dashed rgba(255,255,255,0.05); padding-bottom: 2px;
        }
        .label { color: #888; }
        .value { color: var(--cyan); font-weight: bold; text-shadow: 0 0 5px rgba(0, 243, 255, 0.3); }

        /* PLANET NAV */
        #planet-nav { display: none; flex-wrap: wrap; gap: 5px; margin-top: 10px; }
        .planet-btn {
            flex: 1 0 30%; background: rgba(255,255,255,0.05); border: 1px solid #333; color: #AAA;
            padding: 5px; cursor: pointer; font-size: 9px; text-align: center; transition: 0.2s;
        }
        .planet-btn:hover { border-color: var(--platinum); color: #FFF; background: rgba(255,255,255,0.1); }

        /* SCANLINE & FX */
        #scanline {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(rgba(0,0,0,0) 50%, rgba(0, 0, 0, 0.2) 50%);
            background-size: 100% 4px; pointer-events: none; z-index: 99;
        }

        #toggle-box { margin-top: 10px; display: flex; gap: 10px; }
        .check-lbl { font-size: 10px; color: #888; display: flex; align-items: center; cursor: pointer; }
        .check-lbl input { margin-right: 5px; }

    </style>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/EffectComposer.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/RenderPass.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/ShaderPass.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/shaders/CopyShader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/shaders/LuminosityHighPassShader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/UnrealBloomPass.js"></script>

</head>
<body>

<div id="boot-screen">
    <div id="boot-terminal">
        <div id="boot-text"></div>
        <div id="progress-container">
            <div id="progress-bar"></div>
        </div>
    </div>
</div>

<div id="ui-layer">
    <div id="header">
        <span class="logo">FRAYMUS TITAN // GEN 172</span>
        <div class="btn-group">
            <button class="sys-btn active" onclick="switchMode('GALAXY')" id="btn-galaxy">GALAXY</button>
            <button class="sys-btn" onclick="switchMode('SOLAR')" id="btn-solar">SOLAR</button>
            <button class="sys-btn" onclick="switchMode('SCANNER')" id="btn-scanner">SCANNER</button>
        </div>
        <span id="clock" style="font-size:12px; color:#888;">00:00:00</span>
    </div>

    <div id="sidebar">
        <div id="panel-title" class="panel-header">SYSTEM READY</div>
        <div id="telemetry-content"></div>
        <div id="planet-nav"></div>
        <div id="toggle-box" style="display:none;">
            <label class="check-lbl"><input type="checkbox" id="chk-wire" onchange="toggleWireframe()"> WIREFRAME</label>
            <label class="check-lbl"><input type="checkbox" id="chk-rot" checked> ROTATE</label>
        </div>
    </div>
</div>

<div id="scanline"></div>

<script>
    /**
     * ðŸ§¬ FRAYMUS TITAN // BOOT SEQUENCE
     */

    // --- GLOBAL VARS ---
    let scene, camera, renderer, controls, composer;
    let mode = "NONE";
    let galaxySystem, solarBodies = [], scannerSystem = {}, starField;

    // --- BOOT LOGIC (The Feedback Loop) ---
    const bootText = document.getElementById('boot-text');
    const progressBar = document.getElementById('progress-bar');
    const bootScreen = document.getElementById('boot-screen');
    const uiLayer = document.getElementById('ui-layer');

    function logBoot(msg, type="normal") {
        const div = document.createElement('div');
        div.className = `boot-log ${type}`;
        div.innerText = `> ${msg}`;
        bootText.appendChild(div);
        bootText.scrollTop = bootText.scrollHeight;
    }

    function updateProgress(percent) {
        progressBar.style.width = `${percent}%`;
    }

    // THE ASYNC BOOT SEQUENCE
    function bootSequence() {
        logBoot("FRAYMUS KERNEL INITIALIZING...", "highlight");

        // Step 1: Engine
        setTimeout(() => {
            logBoot("Mounting WebGL Context...");
            initThreeJS();
            updateProgress(20);

            // Step 2: Stars (Heavy)
            setTimeout(() => {
                logBoot("Generating 15,000 Stellar Points...", "warn");
                createHyperStars();
                updateProgress(50);

                // Step 3: Galaxy (Heavy)
                setTimeout(() => {
                    logBoot("Calculating Logarithmic Spirals (Ï†)...", "warn");
                    initGalaxy(); // Pre-load galaxy
                    updateProgress(80);

                    // Step 4: Post-Processing
                    setTimeout(() => {
                        logBoot("Injecting Unreal Bloom Shader...", "success");
                        updateProgress(100);

                        // Final: Launch
                        setTimeout(() => {
                            bootScreen.style.opacity = 0;
                            setTimeout(() => bootScreen.style.display = 'none', 1000);
                            uiLayer.style.opacity = 1;
                            animate();
                        }, 500);
                    }, 200);
                }, 100);
            }, 100);
        }, 500);
    }

    // --- ENGINE SETUP ---
    function initThreeJS() {
        scene = new THREE.Scene();
        scene.fog = new THREE.FogExp2(0x000000, 0.0002);
        camera = new THREE.PerspectiveCamera(60, window.innerWidth/window.innerHeight, 0.1, 5000);

        renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(window.devicePixelRatio);
        renderer.toneMapping = THREE.ReinhardToneMapping;
        document.body.appendChild(renderer.domElement);

        controls = new THREE.OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;

        // Bloom
        const renderScene = new THREE.RenderPass(scene, camera);
        const bloomPass = new THREE.UnrealBloomPass(new THREE.Vector2(window.innerWidth, window.innerHeight), 1.5, 0.4, 0.85);
        bloomPass.threshold = 0; bloomPass.strength = 1.2; bloomPass.radius = 0.5;
        composer = new THREE.EffectComposer(renderer);
        composer.addPass(renderScene);
        composer.addPass(bloomPass);

        const ambient = new THREE.AmbientLight(0x111111);
        scene.add(ambient);

        mode = "GALAXY"; // Default
        window.addEventListener('resize', onResize);
    }

    // --- CONTENT GENERATION ---

    function createHyperStars() {
        const geo = new THREE.BufferGeometry();
        const count = 15000;
        const pos = new Float32Array(count * 3);
        const colors = new Float32Array(count * 3);
        const c1 = new THREE.Color(0x88ccff);
        const c2 = new THREE.Color(0xffbb88);

        for(let i=0; i<count; i++) {
            const r = 2000 + Math.random()*2000;
            const theta = Math.random()*Math.PI*2;
            const phi = Math.acos(2*Math.random()-1);
            pos[i*3] = r * Math.sin(phi) * Math.cos(theta);
            pos[i*3+1] = r * Math.sin(phi) * Math.sin(theta);
            pos[i*3+2] = r * Math.cos(phi);
            const c = Math.random()>0.5?c1:c2;
            colors[i*3]=c.r; colors[i*3+1]=c.g; colors[i*3+2]=c.b;
        }
        geo.setAttribute('position', new THREE.BufferAttribute(pos, 3));
        geo.setAttribute('color', new THREE.BufferAttribute(colors, 3));
        const mat = new THREE.PointsMaterial({size: 2, vertexColors: true, transparent: true, opacity: 0.8});
        starField = new THREE.Points(geo, mat);
        scene.add(starField);
    }

    // --- SWITCHER ---
    function switchMode(newMode) {
        if(mode === newMode) return;
        mode = newMode;

        // UI
        document.querySelectorAll('.sys-btn').forEach(b => b.classList.remove('active'));
        document.getElementById('btn-' + mode.toLowerCase()).classList.add('active');
        document.getElementById('planet-nav').style.display = (mode==='SCANNER')?'flex':'none';
        document.getElementById('toggle-box').style.display = (mode==='SCANNER')?'flex':'none';

        cleanup();
        if(mode==='GALAXY') initGalaxy();
        if(mode==='SOLAR') initSolar();
        if(mode==='SCANNER') { initScanner('EARTH'); populatePlanetNav(); }
    }

    function cleanup() {
        if(galaxySystem) { scene.remove(galaxySystem); galaxySystem = null; }
        solarBodies.forEach(b => { scene.remove(b.mesh); scene.remove(b.orbit); scene.remove(b.trail); if(b.lbl) scene.remove(b.lbl); });
        solarBodies = [];
        if(scannerSystem.mesh) { scene.remove(scannerSystem.mesh); scene.remove(scannerSystem.atm); scene.remove(scannerSystem.ring); scannerSystem={}; }
    }

    // --- GALAXY ---
    function initGalaxy() {
        document.getElementById('panel-title').innerText = "MACRO: MILKY WAY";
        updateTelemetry(`<div class="metric-row"><span class="label">TYPE:</span> <span class="value">SBc (Barred)</span></div>
                         <div class="metric-row"><span class="label">DIAMETER:</span> <span class="value">105,700 LY</span></div>
                         <div class="metric-row"><span class="label">STARS:</span> <span class="value">80,000 (SIM)</span></div>`);
        camera.position.set(0, 400, 700);
        controls.autoRotate = true; controls.autoRotateSpeed = 0.2;

        const count = 80000;
        const geo = new THREE.BufferGeometry();
        const pos = new Float32Array(count*3);
        const col = new Float32Array(count*3);
        const cIn = new THREE.Color(0xffaa55);
        const cOut = new THREE.Color(0x3366ff);

        for(let i=0; i<count; i++) {
            const r = Math.random()*400;
            const spin = r*3.5;
            const branch = (i%2)*Math.PI;
            const rx = (Math.random()-0.5)*(r<50?20:100);
            const ry = (Math.random()-0.5)*(r<50?10:50) * (1-r/500);
            const rz = (Math.random()-0.5)*(r<50?20:100);

            pos[i*3] = Math.cos(spin+branch)*r + rx;
            pos[i*3+1] = ry;
            pos[i*3+2] = Math.sin(spin+branch)*r + rz;

            const mixed = cIn.clone().lerp(cOut, r/350);
            col[i*3]=mixed.r; col[i*3+1]=mixed.g; col[i*3+2]=mixed.b;
        }
        geo.setAttribute('position', new THREE.BufferAttribute(pos, 3));
        geo.setAttribute('color', new THREE.BufferAttribute(col, 3));
        const mat = new THREE.PointsMaterial({size: 1.5, vertexColors: true, blending: THREE.AdditiveBlending, depthWrite: false, transparent: true, opacity: 0.8});
        galaxySystem = new THREE.Points(geo, mat);
        scene.add(galaxySystem);
    }

    // --- SOLAR ---
    function initSolar() {
        document.getElementById('panel-title').innerText = "MESO: SOLAR SYSTEM";
        updateTelemetry(`<div class="metric-row"><span class="label">BODIES:</span> <span class="value">9 MAJOR</span></div>
                         <div class="metric-row"><span class="label">PHYSICS:</span> <span class="value">N-BODY</span></div>`);
        camera.position.set(0, 200, 300);
        controls.autoRotate = false;
        scene.add(new THREE.PointLight(0xffffff, 2, 1000));

        const data = [
            {k:"sun",r:10,d:0,c:0xFFD700}, {k:"mercury",r:1.5,d:25,c:0xA5A5A5}, {k:"venus",r:3,d:40,c:0xE3BB76},
            {k:"earth",r:3.2,d:60,c:0x00A2FF}, {k:"mars",r:2,d:80,c:0xFF4500}, {k:"jupiter",r:8,d:130,c:0xD9A07E},
            {k:"saturn",r:7,d:170,c:0xF4D03F,ring:true}, {k:"uranus",r:5,d:210,c:0x4FD0E7}, {k:"neptune",r:5,d:250,c:0x2E5D94}
        ];

        data.forEach(p => {
            const mat = new THREE.MeshStandardMaterial({color: p.c, emissive: p.d===0?0xffaa00:0, emissiveIntensity: p.d===0?1:0});
            const mesh = new THREE.Mesh(new THREE.SphereGeometry(p.r, 32, 32), mat);
            scene.add(mesh);

            // Label
            const cvs=document.createElement('canvas'); cvs.width=128; cvs.height=32;
            const ctx=cvs.getContext('2d'); ctx.font="bold 20px Courier New"; ctx.fillStyle="#00F3FF"; ctx.textAlign="center"; ctx.fillText(p.k.toUpperCase(),64,22);
            const sprite = new THREE.Sprite(new THREE.SpriteMaterial({map:new THREE.CanvasTexture(cvs), transparent:true}));
            sprite.scale.set(10,2.5,1); scene.add(sprite);

            // Ring
            if(p.ring) {
                const ring = new THREE.Mesh(new THREE.RingGeometry(p.r+2,p.r+6,64), new THREE.MeshBasicMaterial({color:0xaa9966,side:2,transparent:true,opacity:0.5}));
                ring.rotation.x = Math.PI/2; mesh.add(ring);
            }

            // Trail
            const tGeo = new THREE.BufferGeometry(); const tPos = new Float32Array(600);
            tGeo.setAttribute('position', new THREE.BufferAttribute(tPos,3));
            const trail = new THREE.Line(tGeo, new THREE.LineBasicMaterial({color:p.c, transparent:true, opacity:0.3}));
            scene.add(trail);

            solarBodies.push({name:p.k, mesh:mesh, lbl:sprite, trail:trail, tArr:[], dist:p.d, angle:Math.random()*10, speed:(p.d===0?0:2/p.d)});
        });
    }

    // --- SCANNER ---
    function initScanner(k) {
        document.getElementById('panel-title').innerText = `MICRO: ${k}`;
        camera.position.set(0,0,8); controls.autoRotate = true; controls.autoRotateSpeed = 2.0;

        // Procedural Tex
        const cvs=document.createElement('canvas'); cvs.width=512; cvs.height=512; const cx=cvs.getContext('2d');
        cx.fillStyle="#"+(new THREE.Color(k==='EARTH'?0x00A2FF:0xFFFFFF).getHexString()); cx.fillRect(0,0,512,512);
        for(let i=0;i<2000;i++){ cx.fillStyle=Math.random()>0.5?'#FFF':'#000'; cx.globalAlpha=0.1; cx.beginPath(); cx.arc(Math.random()*512,Math.random()*512,Math.random()*5,0,6.28); cx.fill(); }

        const mat = new THREE.MeshStandardMaterial({map:new THREE.CanvasTexture(cvs), roughness:0.6});
        scannerSystem.mesh = new THREE.Mesh(new THREE.SphereGeometry(2.5,64,64), mat);
        scene.add(scannerSystem.mesh);

        const atm = new THREE.Mesh(new THREE.SphereGeometry(2.8,64,64), new THREE.MeshBasicMaterial({color:0x00F3FF, transparent:true, opacity:0.1, side:THREE.BackSide, blending:THREE.AdditiveBlending}));
        scannerSystem.atm = atm; scene.add(atm);
    }

    // --- UTILS ---
    function updateTelemetry(h) { document.getElementById('telemetry-content').innerHTML=h; }
    function populatePlanetNav() {
        const c=document.getElementById('planet-nav'); c.innerHTML='';
        ['MERCURY','VENUS','EARTH','MARS','JUPITER','SATURN','URANUS','NEPTUNE'].forEach(p=>{
            const b=document.createElement('div'); b.className='planet-btn'; b.innerText=p;
            b.onclick=()=>{initScanner(p);}; c.appendChild(b);
        });
    }
    function toggleWireframe() { if(scannerSystem.mesh) scannerSystem.mesh.material.wireframe = document.getElementById('chk-wire').checked; }
    function onResize() { renderer.setSize(window.innerWidth, window.innerHeight); camera.aspect=window.innerWidth/window.innerHeight; camera.updateProjectionMatrix(); composer.setSize(window.innerWidth, window.innerHeight); }

    function animate() {
        requestAnimationFrame(animate);
        controls.update();
        document.getElementById('clock').innerText = new Date().toISOString().split('T')[1].split('.')[0];

        if(mode==='SOLAR') {
            solarBodies.forEach(b => {
                if(b.name==='sun') return;
                b.angle += b.speed;
                b.mesh.position.x = Math.cos(b.angle)*b.dist;
                b.mesh.position.z = Math.sin(b.angle)*b.dist;
                if(b.lbl) { b.lbl.position.copy(b.mesh.position); b.lbl.position.y += b.name==='saturn'?12:8; }
                b.tArr.push(b.mesh.position.x, b.mesh.position.y, b.mesh.position.z);
                if(b.tArr.length>600) b.tArr.splice(0,3);
                b.trail.geometry.setAttribute('position', new THREE.Float32BufferAttribute(b.tArr, 3));
            });
        }
        if(mode==='SCANNER' && scannerSystem.mesh && document.getElementById('chk-rot').checked) {
            scannerSystem.mesh.rotation.y += 0.002; scannerSystem.atm.rotation.y += 0.0025;
        }

        composer.render();
    }

    // START
    bootSequence();

</script>
</body>
</html>