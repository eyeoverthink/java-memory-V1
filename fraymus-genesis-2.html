<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>FRAYMUS GENESIS // GEN 181</title>
    <style>
        /* --- AESTHETIC: DEEP GENETICS --- */
        body { margin: 0; overflow: hidden; background: #050505; font-family: 'Courier New', monospace; color: #E0E0E0; user-select: none; }

        #hud { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; }

        /* HEADER */
        #header {
            position: absolute; top: 0; width: 100%; height: 60px;
            background: linear-gradient(to bottom, rgba(0,20,40,0.9), transparent);
            border-bottom: 1px solid #0088FF;
            display: flex; align-items: center; justify-content: space-between; padding: 0 30px;
        }
        .title { font-size: 18px; font-weight: bold; color: #00FFFF; letter-spacing: 4px; text-shadow: 0 0 10px #00FFFF; }

        /* DATA PANEL */
        #stats {
            position: absolute; top: 70px; left: 20px; width: 280px;
            background: rgba(0, 10, 20, 0.8); border: 1px solid #0088FF;
            padding: 15px; pointer-events: auto;
        }
        .stat-row { display: flex; justify-content: space-between; margin-bottom: 5px; font-size: 11px; }
        .val { color: #00FFFF; font-weight: bold; }

        /* CONTROLS */
        #controls {
            position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%);
            display: flex; gap: 15px; pointer-events: auto;
        }
        .btn {
            background: #000; border: 1px solid #004488; color: #0088FF;
            padding: 10px 20px; cursor: pointer; text-transform: uppercase; font-weight: bold; transition: 0.2s;
        }
        .btn:hover { border-color: #00FFFF; color: #00FFFF; box-shadow: 0 0 15px #00FFFF; }

        canvas { display: block; }
    </style>
</head>
<body>

<div id="hud">
    <div id="header">
        <div class="title">FRAYMUS // GENESIS</div>
        <div style="font-size:11px; color:#00FFFF;">VISUALIZING DNA</div>
    </div>

    <div id="stats">
        <div style="border-bottom:1px dashed #0088FF; margin-bottom:10px; color:#FFF;">EVOLUTIONARY TELEMETRY</div>
        <div class="stat-row"><span>GENERATION MAX:</span> <span class="val" id="gen">0</span></div>
        <div class="stat-row"><span>POPULATION:</span> <span class="val" id="pop">0</span></div>
        <div class="stat-row"><span>AVG SPEED (TAILS):</span> <span class="val" id="avg-spd">0.00</span></div>
        <div class="stat-row"><span>AVG SENSE (HALOS):</span> <span class="val" id="avg-sen">0.00</span></div>
        <div style="margin-top:10px; font-size:10px; color:#888;">* Lines indicate Parent-Child bond</div>
    </div>

    <div id="controls">
        <button class="btn" onclick="triggerMeteor()">METEOR EVENT</button>
        <button class="btn" onclick="boostEntropy()">BOOST STARLIGHT</button>
        <button class="btn" onclick="toggleLines()">TOGGLE BONDS</button>
    </div>
</div>

<canvas id="simCanvas"></canvas>

<script>
    /**
     * ðŸ§¬ FRAYMUS GENESIS // GEN 181
     * Features: Visual Phenotypes, Lineage Tracing, Pulsing Energy.
     */

    const PHI = 1.6180339887;
    const canvas = document.getElementById('simCanvas');
    const ctx = canvas.getContext('2d');

    // --- CONFIG ---
    let width, height;
    let entities = [];
    let food = [];
    let bonds = []; // Stores lineage lines
    let maxGen = 1;
    let showBonds = true;
    let frame = 0;

    // --- CLASSES ---

    class Organism {
        constructor(x, y, dna, parentGen) {
            this.pos = { x: x, y: y };
            this.vel = { x: (Math.random()-0.5)*2, y: (Math.random()-0.5)*2 };

            // DNA: The Code
            this.dna = dna || {
                speed: 2 + (Math.random()-0.5),
                sense: 60 + (Math.random()-0.5)*20,
                size: 4 + (Math.random()-0.5)
            };

            this.gen = parentGen ? parentGen + 1 : 1;
            if(this.gen > maxGen) maxGen = this.gen;

            this.energy = 100;
            this.color = `hsl(${180 + (this.dna.speed*30)}, 100%, 50%)`; // Blue -> Cyan -> Green based on speed
            this.history = []; // For tail
        }

        update() {
            // Physics
            this.pos.x += this.vel.x * (this.dna.speed * 0.4);
            this.pos.y += this.vel.y * (this.dna.speed * 0.4);

            // Toroidal Wrap
            if (this.pos.x < 0) this.pos.x = width; if (this.pos.x > width) this.pos.x = 0;
            if (this.pos.y < 0) this.pos.y = height; if (this.pos.y > height) this.pos.y = 0;

            // Tail Logic (History)
            this.history.push({x:this.pos.x, y:this.pos.y});
            // Tail length based on speed (DNA Visual)
            if(this.history.length > this.dna.speed * 3) this.history.shift();

            // Energy Cost
            this.energy -= (this.dna.speed * this.dna.size) * 0.03;

            // AI (Brain)
            this.interact();
        }

        interact() {
            let closest = null, minDist = Infinity;

            // Find Stars (Food)
            for (let f of food) {
                let d = dist(this.pos, f);
                if (d < this.dna.sense && d < minDist) {
                    minDist = d; closest = f;
                }
            }

            if (closest) {
                // Seek
                let dx = closest.x - this.pos.x;
                let dy = closest.y - this.pos.y;
                let mag = Math.sqrt(dx*dx + dy*dy);
                this.vel.x += (dx/mag) * 0.2;
                this.vel.y += (dy/mag) * 0.2;

                // Eat
                if (minDist < this.dna.size + 5) {
                    this.energy += 40;
                    food.splice(food.indexOf(closest), 1);
                    if (this.energy > 180) this.reproduce();
                }
            }

            // Normalize Speed
            let s = Math.sqrt(this.vel.x*this.vel.x + this.vel.y*this.vel.y);
            if (s > 1) { this.vel.x/=s; this.vel.y/=s; }
        }

        reproduce() {
            this.energy -= 70;
            // Mutate DNA
            let m = 0.15; // Mutation Rate
            let newDNA = {
                speed: this.dna.speed + (Math.random()-0.5)*m,
                sense: this.dna.sense + (Math.random()-0.5)*m*20,
                size: this.dna.size + (Math.random()-0.5)*m
            };

            let child = new Organism(this.pos.x, this.pos.y, newDNA, this.gen);
            entities.push(child);

            // Record Bond (Lineage Visual)
            bonds.push({ p1:this, p2:child, alpha:1.0 });
        }

        draw() {
            // Draw Tail (Speed DNA)
            ctx.beginPath();
            ctx.strokeStyle = this.color;
            ctx.lineWidth = this.dna.size / 2;
            ctx.moveTo(this.pos.x, this.pos.y);
            for(let i=this.history.length-1; i>=0; i--) {
                // Check for wrap-around jump to avoid cross-screen lines
                let p = this.history[i];
                if(Math.abs(p.x - this.pos.x) < 50 && Math.abs(p.y - this.pos.y) < 50) {
                    ctx.lineTo(p.x, p.y);
                }
            }
            ctx.stroke();

            // Draw Body
            ctx.fillStyle = "#FFF";
            ctx.beginPath(); ctx.arc(this.pos.x, this.pos.y, 2, 0, Math.PI*2); ctx.fill();

            // Draw Sense Halo (Sense DNA) - Faint
            if(this.dna.sense > 80) {
                ctx.strokeStyle = `rgba(0, 255, 255, 0.1)`;
                ctx.lineWidth = 1;
                ctx.beginPath(); ctx.arc(this.pos.x, this.pos.y, this.dna.sense/4, 0, Math.PI*2); ctx.stroke();
            }
        }
    }

    // --- SYSTEM ---

    function init() {
        resize();
        // Adam & Eve
        for(let i=0; i<15; i++) entities.push(new Organism(Math.random()*width, Math.random()*height));
        boostEntropy();
        loop();
    }

    function loop() {
        // Fade Background (Trails)
        ctx.fillStyle = "rgba(5, 5, 10, 0.2)";
        ctx.fillRect(0, 0, width, height);

        frame++;

        // 1. STARLOGIC (Food Generation)
        // Phi-based spawning
        if (Math.random() < 0.08 * PHI) {
            food.push({
                x:Math.random()*width,
                y:Math.random()*height,
                phase:Math.random()*Math.PI
            });
        }

        // Draw Stars (Pulsing)
        for(let f of food) {
            let pulse = 2 + Math.sin(frame*0.1 + f.phase);
            ctx.fillStyle = `rgba(255, 255, 200, ${0.5 + Math.sin(frame*0.1)*0.2})`;
            ctx.beginPath(); ctx.arc(f.x, f.y, pulse, 0, Math.PI*2); ctx.fill();
            // Glow
            ctx.fillStyle = "rgba(255, 200, 50, 0.1)";
            ctx.beginPath(); ctx.arc(f.x, f.y, pulse*3, 0, Math.PI*2); ctx.fill();
        }

        // 2. LIFELOGIC
        let avgSpd = 0, avgSen = 0;

        for (let i = entities.length - 1; i >= 0; i--) {
            let e = entities[i];
            e.update();
            e.draw();
            avgSpd += e.dna.speed;
            avgSen += e.dna.sense;
            if (e.energy <= 0) entities.splice(i, 1);
        }

        // 3. BONDLOGIC (Lineage Lines)
        if(showBonds) {
            for(let i = bonds.length - 1; i >= 0; i--) {
                let b = bonds[i];

                // Only draw if both exist
                if(entities.includes(b.p1) && entities.includes(b.p2)) {
                    // Check wrap distance
                    if(dist(b.p1.pos, b.p2.pos) < 200) {
                        ctx.strokeStyle = `rgba(255, 255, 255, ${b.alpha})`;
                        ctx.lineWidth = 1;
                        ctx.beginPath();
                        ctx.moveTo(b.p1.pos.x, b.p1.pos.y);
                        ctx.lineTo(b.p2.pos.x, b.p2.pos.y);
                        ctx.stroke();
                    }
                }

                b.alpha -= 0.02; // Fade out
                if(b.alpha <= 0) bonds.splice(i, 1);
            }
        }

        // 4. TELEMETRY
        if (entities.length > 0) {
            document.getElementById('gen').innerText = maxGen;
            document.getElementById('pop').innerText = entities.length;
            document.getElementById('avg-spd').innerText = (avgSpd / entities.length).toFixed(2);
            document.getElementById('avg-sen').innerText = (avgSen / entities.length).toFixed(2);
        } else {
            // Auto-Restart if extinct
            ctx.fillStyle = "#FFF"; ctx.fillText("EXTINCTION. REBOOTING...", width/2-100, height/2);
            if(Math.random()<0.05) init();
        }

        requestAnimationFrame(loop);
    }

    // --- UTILS ---
    function triggerMeteor() {
        entities = entities.filter(() => Math.random() > 0.8); // Kill 80%
        bonds = []; // Clear lines
    }

    function boostEntropy() {
        for(let i=0; i<50; i++) food.push({x:Math.random()*width, y:Math.random()*height, phase:0});
    }

    function toggleLines() { showBonds = !showBonds; }

    function dist(a, b) { return Math.sqrt(Math.pow(a.x-b.x, 2) + Math.pow(a.y-b.y, 2)); }
    function resize() { width = canvas.width = window.innerWidth; height = canvas.height = window.innerHeight; }
    window.addEventListener('resize', resize);

    init();

</script>
</body>
</html>